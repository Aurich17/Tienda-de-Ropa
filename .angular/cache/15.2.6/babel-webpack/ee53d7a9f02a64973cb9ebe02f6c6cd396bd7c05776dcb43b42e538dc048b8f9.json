{"ast":null,"code":"import _asyncToGenerator from \"C:/Empresa Kopito/Sistema/Web/SistemasKopito/SistemasKopito/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { CdkTableModule } from '@angular/cdk/table';\nimport * as i0 from '@angular/core';\nimport { NgModule, InjectionToken, Injectable, Optional, Inject, EventEmitter, Directive, Input, Output } from '@angular/core';\nimport * as FileSaver from 'file-saver-es';\nlet CdkTableExporterModule = /*#__PURE__*/(() => {\n  class CdkTableExporterModule {}\n  CdkTableExporterModule.ɵfac = function CdkTableExporterModule_Factory(t) {\n    return new (t || CdkTableExporterModule)();\n  };\n  CdkTableExporterModule.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n    type: CdkTableExporterModule\n  });\n  CdkTableExporterModule.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n    imports: [CdkTableModule]\n  });\n  return CdkTableExporterModule;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nvar ExportType = /*#__PURE__*/(() => {\n  (function (ExportType) {\n    ExportType[\"XLS\"] = \"xls\";\n    ExportType[\"XLSX\"] = \"xlsx\";\n    ExportType[\"CSV\"] = \"csv\";\n    ExportType[\"TXT\"] = \"txt\";\n    ExportType[\"JSON\"] = \"json\";\n    ExportType[\"OTHER\"] = \"other\";\n  })(ExportType || (ExportType = {}));\n  return ExportType;\n})();\nclass Mime {\n  constructor(extension, contentTypeHeader) {\n    this.extension = extension;\n    this.contentTypeHeader = contentTypeHeader;\n  }\n}\nconst MAT_TABLE_EXPORTER = 'mat-table-exporter';\nconst TYPE_ARRAY = 'array';\nconst CHAR_SET_UTF = ';charset=utf-';\nconst CHAR_SET_UTF_8 = CHAR_SET_UTF + '8';\nconst CONTENT_TYPE_TEXT = ExportType.TXT + '/';\nconst CONTENT_TYPE_APPLICATION = 'application/';\nconst CONTENT_TYPE_EXCEL = CONTENT_TYPE_APPLICATION + 'octet-stream';\nconst DOT = '.';\nconst COMMA = ',';\nconst EXTENSION_XLS = DOT + ExportType.XLS;\nconst EXTENSION_XLSX = DOT + ExportType.XLSX;\nconst EXTENSION_CSV = DOT + ExportType.CSV;\nconst EXTENSION_JSON = DOT + ExportType.JSON;\nconst EXTENSION_TEXT = DOT + ExportType.TXT;\nconst MIME_EXCEL_XLS = new Mime(EXTENSION_XLS, CONTENT_TYPE_EXCEL + CHAR_SET_UTF_8);\nconst MIME_EXCEL_XLSX = new Mime(EXTENSION_XLSX, CONTENT_TYPE_EXCEL + CHAR_SET_UTF_8);\nconst MIME_JSON = new Mime(EXTENSION_JSON, CONTENT_TYPE_TEXT + JSON + CHAR_SET_UTF_8);\nconst MIME_TXT = new Mime(EXTENSION_TEXT, CONTENT_TYPE_TEXT + ExportType.TXT + CHAR_SET_UTF_8);\nconst MIME_CSV = new Mime(EXTENSION_CSV, CONTENT_TYPE_TEXT + ExportType.CSV + CHAR_SET_UTF_8);\nconst REF = '!ref';\nconst XLS_REGEX = DOT + '*\\.' + ExportType.XLS + '$';\nconst RETURN = '\\n';\nconst TAB = '\\t';\nconst XLSX_COLS = '!cols';\nconst BOM = '\\uFEFF';\nconst XLSX_LIGHTWEIGHT = new InjectionToken('XLSX_LIGHTWEIGHT');\nclass FileUtil {\n  static save(content, mime, options) {\n    const blob = new Blob([content], {\n      type: mime.contentTypeHeader\n    });\n    let fileName = MAT_TABLE_EXPORTER;\n    if (options && options.fileName) {\n      fileName = options.fileName;\n    }\n    FileSaver.saveAs(blob, fileName + mime.extension);\n  }\n  static isXls(fileName) {\n    return fileName.toLowerCase().match(XLS_REGEX) != null;\n  }\n  static identifyExportType(fileName) {\n    if (fileName && FileUtil.isXls(fileName)) {\n      return ExportType.XLS;\n    } else {\n      return ExportType.XLSX;\n    }\n  }\n  static removeExtension(options) {\n    if (options) options.fileName = options.fileName?.split(DOT)[0];\n  }\n}\nlet FileExporter = /*#__PURE__*/(() => {\n  class FileExporter {\n    constructor() {}\n    export(rows, options) {\n      if (!rows) {\n        throw new Error('Empty json array is provided, rows parameter is mandatory!');\n      }\n      const mimeType = this.getMimeType();\n      this.createContent(rows, options).then(content => {\n        FileUtil.save(content, mimeType, options);\n      });\n    }\n  }\n  FileExporter.ɵfac = function FileExporter_Factory(t) {\n    return new (t || FileExporter)();\n  };\n  FileExporter.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n    token: FileExporter,\n    factory: FileExporter.ɵfac,\n    providedIn: 'root'\n  });\n  return FileExporter;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet SheetjsHelperService = /*#__PURE__*/(() => {\n  class SheetjsHelperService {\n    constructor(xlsxLightweight) {\n      this.xlsxLightweight = xlsxLightweight;\n    }\n    getXlsx() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        if (_this.xlsxLightweight) {\n          return yield import('xlsx/dist/xlsx.mini.min');\n        } else {\n          return yield import('xlsx');\n        }\n      })();\n    }\n  }\n  SheetjsHelperService.ɵfac = function SheetjsHelperService_Factory(t) {\n    return new (t || SheetjsHelperService)(i0.ɵɵinject(XLSX_LIGHTWEIGHT, 8));\n  };\n  SheetjsHelperService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n    token: SheetjsHelperService,\n    factory: SheetjsHelperService.ɵfac,\n    providedIn: 'root'\n  });\n  return SheetjsHelperService;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/**\n * An angular service class that is used to create files out of json object arrays.\n */\nlet WorksheetExporter = /*#__PURE__*/(() => {\n  class WorksheetExporter extends FileExporter {\n    constructor(sheetJsHelper) {\n      super();\n      this.sheetJsHelper = sheetJsHelper;\n    }\n    createContent(rows, options) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const workSheet = (yield _this2.sheetJsHelper.getXlsx()).utils.json_to_sheet(rows, {\n          skipHeader: true // we don't want to see object properties as our headers\n        });\n\n        return yield _this2.workSheetToContent(workSheet, options);\n      })();\n    }\n  }\n  WorksheetExporter.ɵfac = function WorksheetExporter_Factory(t) {\n    return new (t || WorksheetExporter)(i0.ɵɵinject(SheetjsHelperService));\n  };\n  WorksheetExporter.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n    token: WorksheetExporter,\n    factory: WorksheetExporter.ɵfac,\n    providedIn: 'root'\n  });\n  return WorksheetExporter;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet CsvExporterService = /*#__PURE__*/(() => {\n  class CsvExporterService extends WorksheetExporter {\n    constructor(sheetJsHelper) {\n      super(sheetJsHelper);\n    }\n    workSheetToContent(worksheet, options) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const content = (yield _this3.sheetJsHelper.getXlsx()).utils.sheet_to_csv(worksheet, {\n          FS: options?.delimiter ?? COMMA\n        });\n        return BOM + content;\n      })();\n    }\n    getMimeType() {\n      return MIME_CSV;\n    }\n  }\n  CsvExporterService.ɵfac = function CsvExporterService_Factory(t) {\n    return new (t || CsvExporterService)(i0.ɵɵinject(SheetjsHelperService));\n  };\n  CsvExporterService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n    token: CsvExporterService,\n    factory: CsvExporterService.ɵfac,\n    providedIn: 'root'\n  });\n  return CsvExporterService;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet TxtExporterService = /*#__PURE__*/(() => {\n  class TxtExporterService extends FileExporter {\n    constructor() {\n      super();\n    }\n    createContent(rows, options) {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        let content = '';\n        rows.forEach(element => {\n          content += Object.values(element).join(_this4.getDelimiter(options)) + RETURN;\n        });\n        return content;\n      })();\n    }\n    getMimeType() {\n      return MIME_TXT;\n    }\n    getDelimiter(options) {\n      if (options && options.delimiter) {\n        return options.delimiter;\n      } else {\n        return TAB;\n      }\n    }\n  }\n  TxtExporterService.ɵfac = function TxtExporterService_Factory(t) {\n    return new (t || TxtExporterService)();\n  };\n  TxtExporterService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n    token: TxtExporterService,\n    factory: TxtExporterService.ɵfac,\n    providedIn: 'root'\n  });\n  return TxtExporterService;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet XlsExporterService = /*#__PURE__*/(() => {\n  class XlsExporterService extends WorksheetExporter {\n    constructor(sheetJsHelper) {\n      super(sheetJsHelper);\n    }\n    workSheetToContent(worksheet, options = {}) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        const {\n          utils,\n          write\n        } = yield _this5.sheetJsHelper.getXlsx();\n        const workBook = utils.book_new();\n        if (options.columnWidths) {\n          worksheet[XLSX_COLS] = _this5.convertToWch(options.columnWidths);\n        }\n        _this5.correctTypes(options);\n        utils.book_append_sheet(workBook, worksheet, options.sheet);\n        return write(workBook, options);\n      })();\n    }\n    getMimeType() {\n      return MIME_EXCEL_XLS;\n    }\n    correctTypes(options) {\n      if (!options.type) {\n        options.type = TYPE_ARRAY;\n      }\n      options.bookType = this.getMimeType().extension.replace('.', ''); // sheetjs requires bookingType for excel format\n    }\n\n    convertToWch(columnWidths) {\n      return columnWidths.map(width => ({\n        wch: width\n      }));\n    }\n  }\n  XlsExporterService.ɵfac = function XlsExporterService_Factory(t) {\n    return new (t || XlsExporterService)(i0.ɵɵinject(SheetjsHelperService));\n  };\n  XlsExporterService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n    token: XlsExporterService,\n    factory: XlsExporterService.ɵfac,\n    providedIn: 'root'\n  });\n  return XlsExporterService;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet JsonExporterService = /*#__PURE__*/(() => {\n  class JsonExporterService extends FileExporter {\n    constructor() {\n      super();\n    }\n    createContent(rows, options) {\n      return _asyncToGenerator(function* () {\n        return JSON.stringify(rows);\n      })();\n    }\n    getMimeType() {\n      return MIME_JSON;\n    }\n  }\n  JsonExporterService.ɵfac = function JsonExporterService_Factory(t) {\n    return new (t || JsonExporterService)();\n  };\n  JsonExporterService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n    token: JsonExporterService,\n    factory: JsonExporterService.ɵfac,\n    providedIn: 'root'\n  });\n  return JsonExporterService;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet XlsxExporterService = /*#__PURE__*/(() => {\n  class XlsxExporterService extends XlsExporterService {\n    constructor(sheetJsHelper) {\n      super(sheetJsHelper);\n    }\n    getMimeType() {\n      return MIME_EXCEL_XLSX;\n    }\n  }\n  XlsxExporterService.ɵfac = function XlsxExporterService_Factory(t) {\n    return new (t || XlsxExporterService)(i0.ɵɵinject(SheetjsHelperService));\n  };\n  XlsxExporterService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n    token: XlsxExporterService,\n    factory: XlsxExporterService.ɵfac,\n    providedIn: 'root'\n  });\n  return XlsxExporterService;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet ServiceLocatorService = /*#__PURE__*/(() => {\n  class ServiceLocatorService {\n    constructor(injector) {\n      this.injector = injector;\n    }\n    getService(exportType, customExporter) {\n      switch (exportType) {\n        case ExportType.XLS.valueOf():\n          return this.injector.get(XlsExporterService);\n        case ExportType.XLSX.valueOf():\n          return this.injector.get(XlsxExporterService);\n        case ExportType.JSON.valueOf():\n          return this.injector.get(JsonExporterService);\n        case ExportType.TXT.valueOf():\n          return this.injector.get(TxtExporterService);\n        case ExportType.CSV.valueOf():\n          return this.injector.get(CsvExporterService);\n        case ExportType.OTHER.valueOf():\n          if (!customExporter) {\n            console.error(\"Provide a custom exporter implementation. Using default exporter.\");\n            return this.injector.get(XlsxExporterService);\n          } else {\n            return customExporter;\n          }\n        default:\n          return this.injector.get(XlsxExporterService);\n      }\n    }\n  }\n  ServiceLocatorService.ɵfac = function ServiceLocatorService_Factory(t) {\n    return new (t || ServiceLocatorService)(i0.ɵɵinject(i0.Injector));\n  };\n  ServiceLocatorService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n    token: ServiceLocatorService,\n    factory: ServiceLocatorService.ɵfac,\n    providedIn: 'root'\n  });\n  return ServiceLocatorService;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet DataExtractorService = /*#__PURE__*/(() => {\n  class DataExtractorService {\n    constructor() {}\n    extractRows(cdkTable, hiddenColumns, outlet) {\n      return this.getRowsAsJsonArray(cdkTable, outlet ?? cdkTable._rowOutlet, hiddenColumns);\n    }\n    getRowsAsJsonArray(cdkTable, outlet, hiddenColumns) {\n      const renderedRows = this.getRenderedRows(cdkTable, outlet);\n      return this.convertToJsonArray(renderedRows, hiddenColumns);\n    }\n    getRenderedRows(cdkTable, outlet) {\n      return cdkTable._getRenderedRows(outlet);\n    }\n    convertToJsonArray(rows, hiddenColumns) {\n      const result = new Array();\n      // tslint:disable-next-line:prefer-for-of\n      for (let i = 0; i < rows.length; i++) {\n        const row = this.convertRow(rows[i], hiddenColumns);\n        result.push(this.createExcelItem(row));\n      }\n      return result;\n    }\n    convertRow(row, hiddenColumns) {\n      const result = new Array();\n      const cells = row.children;\n      for (let i = 0; i < cells.length; i++) {\n        if (!this.shouldHide(i, hiddenColumns)) {\n          const element = cells.item(i).innerText.trim();\n          result.push(element);\n        }\n      }\n      return result;\n    }\n    shouldHide(columnIndex, hiddenColumns) {\n      if (hiddenColumns && hiddenColumns.includes(columnIndex)) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n    createExcelItem(row) {\n      return Object.assign({}, row);\n    }\n  }\n  DataExtractorService.ɵfac = function DataExtractorService_Factory(t) {\n    return new (t || DataExtractorService)();\n  };\n  DataExtractorService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n    token: DataExtractorService,\n    factory: DataExtractorService.ɵfac,\n    providedIn: 'root'\n  });\n  return DataExtractorService;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/**\n * Exporter class for CdkTable. Abstracts the varying behaviors among different CdkTable implementations.\n */\nlet CdkTableExporter = /*#__PURE__*/(() => {\n  class CdkTableExporter {\n    constructor(serviceLocator, dataExtractor, _cdkTable) {\n      this.serviceLocator = serviceLocator;\n      this.dataExtractor = dataExtractor;\n      this._cdkTable = _cdkTable;\n      this.exportCompleted = new EventEmitter();\n      this.exportStarted = new EventEmitter();\n    }\n    /**\n     * Triggers page event chain thus extracting and exporting all the rows in nativetables in pages\n     */\n    exportTable(exportType, options) {\n      this.loadExporter(exportType);\n      this._options = options;\n      this.exportStarted.emit();\n      this._isIterating = true;\n      this._isExporting = true;\n      this._data = new Array();\n      this.extractTableHeader();\n      try {\n        this.exportWithPagination();\n      } catch (notPaginated) {\n        this.exportSinglePage();\n      }\n    }\n    toggleRow(index) {\n      const paginatedRowIndex = this.getPaginatedRowIndex(index);\n      if (this.isToggleOn(paginatedRowIndex)) {\n        this.toggleOff(paginatedRowIndex);\n      } else {\n        this.toggleOn(paginatedRowIndex);\n      }\n    }\n    /**\n     * This event will clear rows selection done using toggleRow functionality\n     */\n    resetToggleRows() {\n      this._selectedRows = [];\n    }\n    toggleOn(index) {\n      this._selectedRows = [...(this._selectedRows || []), index];\n    }\n    toggleOff(index) {\n      this._selectedRows = this._selectedRows.filter(x => x !== index);\n    }\n    isToggleOn(index) {\n      return this._selectedRows?.includes(index);\n    }\n    loadExporter(exportType) {\n      this._exporterService = this.serviceLocator.getService(exportType, this.exporter);\n    }\n    exportWithPagination() {\n      this._initialPageIndex = this.getCurrentPageIndex();\n      this.initPageHandler();\n      this.goToPage(0);\n    }\n    exportSinglePage() {\n      this.extractDataOnCurrentPage();\n      this.extractTableFooter();\n      this.exportExtractedData();\n    }\n    extractDataOnCurrentPage() {\n      const rows = this.dataExtractor.extractRows(this._cdkTable, this.hiddenColumns);\n      this._data = this._data.concat(this.getSelectedRows(rows));\n    }\n    getSelectedRows(rows) {\n      if (this.isSelectiveExport()) {\n        return rows.filter((_, i) => this._selectedRows.includes(this.getPaginatedRowIndex(i)));\n      } else {\n        return rows;\n      }\n    }\n    isSelectiveExport() {\n      return this._selectedRows && !this.isMasterToggleOff() && !this.isMasterToggleOn();\n    }\n    isMasterToggleOn() {\n      return this.compareSelectedRowCount(this.getTotalItemsCount());\n    }\n    isMasterToggleOff() {\n      return this.compareSelectedRowCount(0);\n    }\n    compareSelectedRowCount(rowCount) {\n      return !!(this._selectedRows.length === rowCount);\n    }\n    initPageHandler() {\n      if (!this._subscription) {\n        this._subscription = this.getPageChangeObservable()?.subscribe(() => {\n          setTimeout(() => {\n            if (this._isIterating) {\n              this.extractDataOnCurrentPage();\n              if (this.hasNextPage()) {\n                this.nextPage();\n              } else {\n                this._isIterating = false;\n                this.goToPage(this._initialPageIndex);\n              }\n            } else if (this._isExporting) {\n              this._isExporting = false;\n              this.extractTableFooter();\n              this.exportExtractedData();\n            }\n          });\n        });\n      }\n    }\n    exportExtractedData() {\n      this._exporterService.export(this._data, this._options);\n      this._data = new Array();\n      this.exportCompleted.emit();\n    }\n    extractSpecialRows(outlet) {\n      this._data.push(...this.dataExtractor.extractRows(this._cdkTable, this.hiddenColumns, outlet));\n    }\n    extractTableHeader() {\n      this.extractSpecialRows(this._cdkTable._headerRowOutlet);\n    }\n    extractTableFooter() {\n      this.extractSpecialRows(this._cdkTable._footerRowOutlet);\n    }\n    hasNextPage() {\n      if (this.getCurrentPageIndex() < this.getPageCount() - 1) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n    nextPage() {\n      this.goToPage(this.getCurrentPageIndex() + 1);\n    }\n    getPaginatedRowIndex(index) {\n      return index + this.getPageSize() * this.getCurrentPageIndex();\n    }\n  }\n  CdkTableExporter.ɵfac = function CdkTableExporter_Factory(t) {\n    i0.ɵɵinvalidFactory();\n  };\n  CdkTableExporter.ɵdir = /* @__PURE__ */i0.ɵɵdefineDirective({\n    type: CdkTableExporter,\n    inputs: {\n      hiddenColumns: \"hiddenColumns\",\n      exporter: \"exporter\"\n    },\n    outputs: {\n      exportCompleted: \"exportCompleted\",\n      exportStarted: \"exportStarted\"\n    }\n  });\n  return CdkTableExporter;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/*\n * Public API Surface of cdk-table-exporter\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { BOM, CHAR_SET_UTF, CHAR_SET_UTF_8, COMMA, CONTENT_TYPE_APPLICATION, CONTENT_TYPE_EXCEL, CONTENT_TYPE_TEXT, CdkTableExporter, CdkTableExporterModule, CsvExporterService, DOT, DataExtractorService, EXTENSION_CSV, EXTENSION_JSON, EXTENSION_TEXT, EXTENSION_XLS, EXTENSION_XLSX, ExportType, FileExporter, FileUtil, JsonExporterService, MAT_TABLE_EXPORTER, MIME_CSV, MIME_EXCEL_XLS, MIME_EXCEL_XLSX, MIME_JSON, MIME_TXT, Mime, REF, RETURN, ServiceLocatorService, TAB, TYPE_ARRAY, TxtExporterService, WorksheetExporter, XLSX_COLS, XLSX_LIGHTWEIGHT, XLS_REGEX, XlsExporterService, XlsxExporterService };\n//# sourceMappingURL=cdk-table-exporter.mjs.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}